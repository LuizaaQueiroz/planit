{% extends 'base.html' %}

{% block title %}Calend√°rio{% endblock %}

{% block content %}
<h2>{{ month_name }} {{ year }}</h2>

<!-- Navega√ß√£o de meses -->
<div class="mb-3 d-flex gap-2">
    <a href="{{ url_for('calendar_view', year=prev_year, month=prev_month) }}" class="btn btn-outline-success btn-sm" accesskey="n">‚Üê M√™s Anterior (Alt+N)</a>
    <a href="{{ url_for('calendar_view', year=next_year, month=next_month) }}" class="btn btn-outline-success btn-sm" accesskey="m">Pr√≥ximo M√™s (Alt+M) ‚Üí</a>
</div>

<!-- Grid do Calend√°rio -->
<div class="calendar-grid">
    <div class="calendar-header">Dom</div>
    <div class="calendar-header">Seg</div>
    <div class="calendar-header">Ter</div>
    <div class="calendar-header">Qua</div>
    <div class="calendar-header">Qui</div>
    <div class="calendar-header">Sex</div>
    <div class="calendar-header">S√°b</div>

    {% set today_day = current_date.day %}
    {% set today_month = current_date.month %}
    {% set today_year = current_date.year %}

    {% for day in month_days %}
        {% if day == 0 %}
            <div class="calendar-cell empty"></div>
        {% else %}
            {% set is_today = (day == today_day and month == today_month and year == today_year) %}
            <div class="calendar-cell {% if day in events_by_day %}has-event{% endif %} {% if is_today %}today{% endif %}" onclick="toggleActive(this)">

                <!-- N√∫mero da Data (clic√°vel para criar evento) -->
                <div class="date-number">
                    <a href="{{ url_for('create_event_for_day', year=year, month=month, day=day) }}" class="text-success fw-bold text-decoration-none">
                        {{ day }}
                    </a>
                </div>

                <!-- Lista de Eventos/Tarefas do Dia -->
                {% if day in events_by_day %}
                    <ul class="event-list p-0 mt-2" style="list-style: none;">
                        {% for item in events_by_day[day] %}
                            <li class="small d-flex justify-content-between">
                                <span>
                                    {% if item.type == 'event' %}
                                        üìç {{ item.title }} {% if item.time %}- {{ item.time.strftime('%H:%M') }}{% endif %}
                                    {% elif item.type == 'task' %}
                                        üìå {{ item.title }}
                                    {% endif %}
                                </span>

                                {% if item.type == 'event' %}
                                    <a href="{{ url_for('delete_event', id=item.id) }}" class="text-danger text-decoration-none small ms-2 delete-event" onclick="return confirm('Excluir este evento?');">üóëÔ∏è</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}
</div>

<!-- Script: Remover o zoom ao clicar fora -->
<script>
    function toggleActive(cell) {
        document.querySelectorAll('.calendar-cell.active').forEach(function(el) {
            el.classList.remove('active');
        });
        cell.classList.add('active');
    }

    document.addEventListener('click', function(event) {
        const isCalendarCell = event.target.closest('.calendar-cell');
        if (!isCalendarCell) {
            document.querySelectorAll('.calendar-cell.active').forEach(function(el) {
                el.classList.remove('active');
            });
        }
    });
</script>
{% endblock %}
